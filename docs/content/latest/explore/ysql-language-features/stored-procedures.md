---
title: Stored Procedures
linkTitle: Stored Procedures
description: Stored Procedures in YSQL
headcontent: Stored Procedures in YSQL
image: /images/section_icons/index/explore.png
menu:
  latest:
    identifier: explore-ysql-language-features-stored-procedures
    parent: explore-ysql-language-features
    weight: 300
isTocNested: true
showAsideToc: true
---

This section describes how to use stored procedures to perform transactions.

## Overview

Stored procedures, in large part, are simply functions that support transactions. PostgreSQL 11 introduced stored procedures, and Yugabyte supports them as well.

## Creating a Stored Procedure

To create a stored procedure in YSQL, use the `CREATE PROCEDURE` statement, which has the following syntax:

```sql
CREATE [OR REPLACE] PROCEDURE procedure_name(parameter_list)
LANGUAGE SQL
AS $$
DECLARE
-- variable declaration
BEGIN
-- stored procedure body
END;
$$;
```

For example:

```sql
create procedure insert_data(a integer, b integer)
  language sql
as $$
begin
  insert into tbl values (a);
  insert into tbl values (b);
end;
$$;
```

{{< note title="Using return" >}}

Stored procedures don't return any values, other than errors. In a function, you use `return <expression>` to return a value. In a stored procedure, `return` does not support an expression, and ends the procedure immediately.

To return a value from a stored procedure, use an [`INOUT`](../../../api/ysql/keywords) parameter.

{{< /note >}}

## Invoking a Stored Procedure

To invoke a stored procedure, use the `CALL` statement, which has the following syntax:

```sql
CALL stored_procedure_name(argument_list)
```

Using the procedure from the previous section:

```sql
yugabyte=# call insert_data(1, 2);
```

## Deleting a Stored Procedure

To remove a stored procedure, use the `DROP PROCEDURE` statement, which has the following syntax:

```sql
DROP PROCEDURE [IF EXISTS] stored_procedure_name(argument_list)
    [ CASCADE | RESTRICT ]
```

For example,

```sql
yugabyte=# drop procedure insert_data(integer, integer);
```

If the name of the stored procedure is not unique (for example, if you had two `insert_data()` procedures, one of which accepted two integers and another which accepted an integer and a varchar), you must specify the data types in the `DROP PROCEDURE` statement. Otherwise, you can omit the data types.

## Example Workflow

Create an `accounts` table with two users, and give both users $10,000 to start with:

```sql
yugabyte=# drop table if exists accounts;

create table accounts (
  id int generated by default as identity,
  name varchar(100) not null,
  balance dec(15,2) not null,
  primary key(id)
);

insert into accounts(name,balance)
values('User1',10000);

insert into accounts(name,balance)
values('User2',10000);
```

```sql
yugabyte=# select * from accounts;
```

```
 id | name  | balance  
----+-------+----------
  1 | User1 | 20000.00
  2 | User2 | 20000.00
(2 rows)
```

Now, create a stored procedure to move money from one account to another:

```sql
create or replace procedure move_money(
   origin integer,
   destination integer, 
   amount decimal
)
language plpgsql
as $$
begin
    -- subtracting the amount from the origin account 
    update accounts 
    set balance = balance - amount 
    where id = origin;

    -- adding the amount to the destination account
    update accounts 
    set balance = balance + amount 
    where id = destination;

    commit;
end;$$;
```

Move $1000 from the first account to the second, and make sure it worked:

```sql
yugabyte=# call move_money(1,2,1000);

yugabyte=# select * from accounts;
```

```
 id | name  | balance  
----+-------+----------
  1 | User1 | 19000.00
  2 | User2 | 21000.00
(2 rows)
```

Finally, clean up by removing the stored procedure and table:

```sql
yugabyte=# drop procedure if exists move_money;
DROP PROCEDURE

yugabyte=# drop table if exists accounts;
DROP TABLE
```
