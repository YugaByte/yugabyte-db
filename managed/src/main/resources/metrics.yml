# Copyright (c) YugaByte, Inc.
# Prometheus metrics query, and related params
---
cpu_usage_user:
  metric: "collectd_cpu_percent"
  function: "avg"
  filters:
    cpu: "user"
  layout:
    title: "CPU Usage (User)"
    xaxis:
      type: "date"
cpu_usage_system:
  metric: "collectd_cpu_percent"
  function: "avg"
  filters:
    cpu: "system"
  layout:
    title: "CPU Usage (System)"
    xaxis:
      type: "date"
cpu_usage:
  metric: "collectd_cpu_percent"
  function: "avg"
  filters:
    cpu: "user|system"
  group_by: "cpu"
  layout:
    title: "CPU Usage (pct)"
    xaxis:
      type: "date"
disk_iops:
  metric: "collectd_yb_system_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "iostat_write_count|iostat_read_count"
  group_by: "type"
  layout:
    title: "Disk IOPS / Node"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "iostat_write_count": "Writes"
        "iostat_read_count": "Reads"

tserver_rpcs_per_sec_by_universe:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rpc_TabletServerService_Write.num|rpc_TabletServerService_Read.num"
  group_by: "type, node_prefix"
  layout:
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_TabletServerService_Write.num": "Write"
        "rpc_TabletServerService_Read.num": "Read"

memory_usage:
  metric: "collectd_memory"
  function: "avg"
  filters:
    memory: "used|buffered|cached|free"
  group_by: "memory"
  layout:
    title: "Memory Usage (bytes)"
    xaxis:
      type: "date"

memory_usage_all:
  metric: "collectd_memory"
  function: "avg"
  filters:
    memory: "used"
  group_by: "exported_instance"
  layout:
    title: "Memory Usage (bytes)"
    xaxis:
      type: "date"

network_bytes:
  metric: "collectd_yb_system_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "net_bytes_sent|net_bytes_recv"
  group_by: "type"
  layout:
    title: "Network Bytes / Sec / Node"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "net_bytes_sent": "TX"
        "net_bytes_recv": "RX"

network_packets:
  metric: "collectd_yb_system_counter_total"
  function: "rate|avg"
  range: "1m"
  operator: "/ 10"
  filters:
    type: "net_packets_sent|net_packets_recv"
  group_by: "type"
  layout:
    title: "Network Packets / Sec / Node"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "node_network_receive_packets": "RX"
        "node_network_transmit_packets": "TX"

network_errors:
  metric: "collectd_yb_system_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "net_errin|net_errout"
  group_by: "type"
  layout:
    title: "Network Errors / Sec / Node"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "net_errin": "RX"
        "net_errout": "TX"

system_load_over_time:
  metric: "multi-metric"
  filters:
    __name__: "collectd_load_.+"
  function: "avg"
  group_by: "__name__"
  layout:
    title: "System Load Over Time"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "collectd_load_0": "Small"
        "collectd_load_1": "Medium"
        "collectd_load_2": "Large"

disk_bytes_per_second_per_node:
  metric: "collectd_yb_system_counter_total"
  filters:
    type: "iostat_read_bytes|iostat_write_bytes"
  range: "1m"
  function: "rate|avg"
  group_by: "type"
  layout:
    title: "Disk Bytes / Sec / Node"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "iostat_read_bytes": "Read"
        "iostat_write_bytes": "Write"

redis_rpcs_per_sec:
  metric: "collectd_yb_redis_counter_total"
  function: "rate|sum"
  range: "1m"
  operator: "> 0"
  filters:
    type: "rpc_RedisServerService_[^_]*.num"
  group_by: "type"
  layout:
    title: "Total Redis Ops / Sec"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_RedisServerService_get.num": "Get"
        "rpc_RedisServerService_set.num": "Set"
        "rpc_RedisServerService_config.num": "Config"
        "rpc_RedisServerService_mget.num": "MGet"
        "rpc_RedisServerService_hget.num": "HGet"
        "rpc_RedisServerService_hmget.num": "HMGet"
        "rpc_RedisServerService_hgetall.num": "HGetAll"
        "rpc_RedisServerService_hkeys.num": "HKeys"
        "rpc_RedisServerService_hvals.num": "HVals"
        "rpc_RedisServerService_hlen.num": "HLen"
        "rpc_RedisServerService_hexists.num": "HExists"
        "rpc_RedisServerService_hstrlen.num": "HStrLen"
        "rpc_RedisServerService_smembers.num": "SMembers"
        "rpc_RedisServerService_sismember.num": "SIsMember"
        "rpc_RedisServerService_scard.num": "SCard"
        "rpc_RedisServerService_strlen.num": "StrLen"
        "rpc_RedisServerService_exists.num": "Exists"
        "rpc_RedisServerService_getrange.num": "GetRange"
        "rpc_RedisServerService_role.num": "Role"
        "rpc_RedisServerService_mset.num": "MSet"
        "rpc_RedisServerService_hset.num": "HSet"
        "rpc_RedisServerService_hmset.num": "HMSet"
        "rpc_RedisServerService_hdel.num": "HDel"
        "rpc_RedisServerService_sadd.num": "SAdd"
        "rpc_RedisServerService_srem.num": "SRem"
        "rpc_RedisServerService_getset.num": "GetSet"
        "rpc_RedisServerService_append.num": "Append"
        "rpc_RedisServerService_del.num": "Del"
        "rpc_RedisServerService_setrange.num": "SetRange"
        "rpc_RedisServerService_incr.num": "Incr"
        "rpc_RedisServerService_echo.num": "Echo"
        "rpc_RedisServerService_auth.num": "Auth"

redis_ops_latency:
  metric: "collectd_yb_redis_counter_total"
  function: "avg"
  operator: "/ 1000 > 0"
  filters:
    type: "rpc_RedisServerService_[^_]*.avg"
  group_by: "type"
  layout:
    title: "Redis Op Latency"
    xaxis:
      type: "date"
    yaxis:
      ticksuffix: "&nbsp;ms"
      alias:
        "rpc_RedisServerService_get.avg": "Get"
        "rpc_RedisServerService_set.avg": "Set"
        "rpc_RedisServerService_config.avg": "Config"
        "rpc_RedisServerService_mget.avg": "MGet"
        "rpc_RedisServerService_hget.avg": "HGet"
        "rpc_RedisServerService_hmget.avg": "HMGet"
        "rpc_RedisServerService_hgetall.avg": "HGetAll"
        "rpc_RedisServerService_hkeys.avg": "HKeys"
        "rpc_RedisServerService_hvals.avg": "HVals"
        "rpc_RedisServerService_hlen.avg": "HLen"
        "rpc_RedisServerService_hexists.avg": "HExists"
        "rpc_RedisServerService_hstrlen.avg": "HStrLen"
        "rpc_RedisServerService_smembers.avg": "SMembers"
        "rpc_RedisServerService_sismember.avg": "SIsMember"
        "rpc_RedisServerService_scard.avg": "SCard"
        "rpc_RedisServerService_strlen.avg": "StrLen"
        "rpc_RedisServerService_exists.avg": "Exists"
        "rpc_RedisServerService_getrange.avg": "GetRange"
        "rpc_RedisServerService_role.avg": "Role"
        "rpc_RedisServerService_mset.avg": "MSet"
        "rpc_RedisServerService_hset.avg": "HSet"
        "rpc_RedisServerService_hmset.avg": "HMSet"
        "rpc_RedisServerService_hdel.avg": "HDel"
        "rpc_RedisServerService_sadd.avg": "SAdd"
        "rpc_RedisServerService_srem.avg": "SRem"
        "rpc_RedisServerService_getset.avg": "GetSet"
        "rpc_RedisServerService_append.avg": "Append"
        "rpc_RedisServerService_del.avg": "Del"
        "rpc_RedisServerService_setrange.avg": "SetRange"
        "rpc_RedisServerService_incr.avg": "Incr"
        "rpc_RedisServerService_echo.avg": "Echo"
        "rpc_RedisServerService_auth.avg": "Auth"

redis_yb_local_vs_remote:
  metric: "collectd_yb_redis_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rpc_read_remote.num|rpc_write_remote.num|rpc_read_local.num|rpc_write_local.num"
  group_by: "type"
  layout:
    title: "YBClient Ops Local vs Remote"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_read_remote.num": "Remote Read"
        "rpc_write_remote.num": "Remote Write"
        "rpc_read_local.num": "Local Read"
        "rpc_write_local.num": "Local Write"

redis_yb_latency:
  metric: "collectd_yb_redis_counter_total"
  function: "avg"
  operator: "/ 1000"
  filters:
    type: "rpc_read_remote.avg|rpc_write_remote.avg|rpc_read_local.avg|rpc_write_local.avg"
  group_by: "type"
  layout:
    title: "YBClient Latency"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_read_remote.avg": "Remote Read"
        "rpc_write_remote.avg": "Remote Write"
        "rpc_read_local.avg": "Local Read"
        "rpc_write_local.avg": "Local Write"
      ticksuffix: "&nbsp;ms"

redis_reactor_latency:
  metric: "collectd_yb_redis_counter_total"
  function: "avg"
  filters:
    type: "rpc_incoming_queue_time.avg|handler_latency_outbound_transfer.avg|handler_latency_outbound_call_queue_time.avg"
  group_by: "type"
  layout:
    title: "YBClient Reactor Delays"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_incoming_queue_time.avg": "Incoming Queue"
        "handler_latency_outbound_transfer.avg": "Outbound transfer time"
        "handler_latency_outbound_call_queue_time.avg": "Outbound queue time"
      ticksuffix: "&nbsp;\u00B5s"

# tserver metrics
tserver_ops_latency:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  operator: "/ 1000"
  filters:
    type: "rpc_TabletServerService_Scan.avg|rpc_TabletServerService_Write.avg|rpc_TabletServerService_Read.avg"
  group_by: "type"
  layout:
    title: "YugaByte Op Latency"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_TabletServerService_Scan.avg": "Scan"
        "rpc_TabletServerService_Write.avg": "Write"
        "rpc_TabletServerService_Read.avg": "Read"
      ticksuffix: "&nbsp;ms"

tserver_write_latency:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  operator: "/ 1000"
  filters:
    type: "rpc_TabletServerService_Write.avg"
  group_by: "exported_instance"
  layout:
    title: "YugaByte Write Latency"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_TabletServerService_Write.avg": "Write"
      ticksuffix: "&nbsp;ms"

tserver_read_latency:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  operator: "/ 1000"
  filters:
    type: "rpc_TabletServerService_Read.avg"
  group_by: "exported_instance"
  layout:
    title: "YugaByte Read Latency"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_TabletServerService_Read.avg": "Read"
      ticksuffix: "&nbsp;ms"

tserver_handler_latency:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  operator: "/ 1000"
  filters:
    type: "rpc_incoming_queue_time.avg|handler_latency_outbound_call_queue_time.avg|handler_latency_outbound_transfer.avg"
  group_by: "type"
  layout:
    title: "YugaByte Reactor Delays"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_incoming_queue_time.avg": "Incoming queue time"
        "handler_latency_outbound_call_queue_time.avg": "Outbound queue time"
        "handler_latency_outbound_transfer.avg": "Outbound transfer time"
      ticksuffix: "&nbsp;ms"

tserver_rpcs_per_sec:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rpc_TabletServerService_Scan.num|rpc_TabletServerService_Write.num|rpc_TabletServerService_Read.num"
  group_by: "type"
  layout:
    title: "YugaByte RPCs / Sec / Node"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_TabletServerService_Scan.num": "Scan"
        "rpc_TabletServerService_Write.num": "Write"
        "rpc_TabletServerService_Read.num": "Read"

tserver_consensus_rpcs_per_sec:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|sum"
  range: "1m"
  filters:
    type: "rpc_ConsensusService_UpdateConsensus.num|rpc_ConsensusService_RequestConsensusVote.num"
  group_by: "type"
  layout:
    title: "Consensus Rpc Ops (Sum) per Sec"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_ConsensusService_UpdateConsensus.num": "UpdateConsensus"
        "rpc_ConsensusService_RequestConsensusVote.num": "RequestConsensusVote"

tserver_change_config:
  metric: "collectd_yb_tserver_counter_total"
  function: "sum"
  filters:
    type: "rpc_ConsensusService_ChangeConfig.num|rpc_ConsensusService_RunLeaderElection.num|rpc_ConsensusService_LeaderStepDown.num|rpc_ConsensusService_LeaderElectionLost.num"
  group_by: "type"
  layout:
    title: "Change Config Ops (Sum) per Sec"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_ConsensusService_ChangeConfig.num": "Change Config"
        "rpc_ConsensusService_RunLeaderElection.num": "RunLeaderElection"
        "rpc_ConsensusService_LeaderStepDown.num": "LeaderStepDown"
        "rpc_ConsensusService_LeaderElectionLost.num": "LeaderElectionLost"

tserver_remote_bootstraps:
  metric: "collectd_yb_tserver_counter_total"
  function: "sum"
  filters:
    type: "rpc_ConsensusService_StartRemoteBootstrap.num"
  group_by: "exported_instance"
  layout:
    title: "Remote Bootstraps"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_ConsensusService_StartRemoteBootstrap.num": "StartRemoteBootstrap"

tserver_consensus_rpcs_latency:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  operator: "/ 1000"
  range: "1m"
  filters:
    type: "rpc_ConsensusService_UpdateConsensus.avg|rpc_ConsensusService_RequestConsensusVote.avg"
  group_by: "type"
  layout:
    title: "Consensus Rpc latencies"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_ConsensusService_UpdateConsensus.avg": "UpdateConsensus"
        "rpc_ConsensusService_RequestConsensusVote.avg": "RequestConsensusVote"
      ticksuffix: "&nbsp;ms"

tserver_change_config_latency:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  operator: "/ 1000"
  range: "1m"
  filters:
    type: "rpc_ConsensusService_ChangeConfig.avg"
  group_by: "type"
  layout:
    title: "Change Config Latency"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_ConsensusService_ChangeConfig.avg": "Change Config"
      ticksuffix: "&nbsp;ms"

tserver_threads:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "threads_running|threads_started"
  group_by: "type"
  layout:
    title: "Threads"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "threads_running": "Running"
        "threads_started": "Started"

tserver_context_switches:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "involuntary_context_switches|voluntary_context_switches"
  group_by: "type"
  layout:
    title: "Context Switches"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "involuntary_context_switches": "Involuntary"
        "voluntary_context_switches": "Voluntary"
tserver_spinlock_server:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  operator: "/ 1000000"
  range: "1m"
  filters:
    type: "spinlock_contention_time"
  group_by: "type"
  layout:
    title: "SpinLock Time/Server"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "spinlock_contention_time": "SpinLock"
      ticksuffix: "&nbsp;sec"
tserver_log_latency:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  filters:
    type: "log_sync_latency.avg|log_group_commit_latency.avg|log_append_latency.avg"
  group_by: "type"
  layout:
    title: "TServer Log Latency"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "log_sync_latency.avg": "Sync"
        "log_group_commit_latency.avg": "Commit"
        "log_append_latency.avg": "Append"
      ticksuffix: "&nbsp;\u00B5s"

tserver_log_bytes_written:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "log_bytes_logged"
  group_by: "exported_instance"
  layout:
    title: "Log Bytes Written / Sec / TServer"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "log_bytes_logged": "Log Bytes Logged"

tserver_log_bytes_read:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "log_reader_bytes_read"
  group_by: "exported_instance"
  layout:
    title: "Log Bytes Read / Sec / TServer"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "log_reader_bytes_read": "Log Bytes Read"

tserver_log_ops_second:
   metric: "collectd_yb_tserver_counter_total"
   function: "rate|avg"
   range: "1m"
   filters:
     type: "log_group_commit_latency.num|log_append_latency.num|log_sync_latency.num"
   group_by: "type"
   layout:
     title: "TServer Log Ops / Sec / Node"
     xaxis:
       type: "date"
     yaxis:
       alias:
         "log_group_commit_latency.num": "Commit"
         "log_append_latency.num": "Append"
         "log_sync_latency.num": "Sync"
       ticksuffix: "&nbsp;ops"
tserver_tc_malloc_stats:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  filters:
    type: "tcmalloc_current_total_thread_cache_bytes|tcmalloc_max_total_thread_cache_bytes|
           tcmalloc_pageheap_free_bytes|tcmalloc_pageheap_unmapped_bytes"
  group_by: "type"
  layout:
    title: "TServer TCMalloc Stats"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "tcmalloc_current_total_thread_cache_bytes": "Reserved"
        "tcmalloc_max_total_thread_cache_bytes": "Usage"
        "tcmalloc_pageheap_free_bytes": "Free"
        "tcmalloc_pageheap_unmapped_bytes": "Small"

tserver_log_stats:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  filters:
    type: "log_reader_bytes_read|log_cache_size"
  group_by: "type"
  layout:
    title: "Log Stats"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "log_reader_bytes_read": "Log Bytes Read"
        "log_cache_size": "Log Cache Size"
      ticksuffix: "&nbsp;KiB"

tserver_cache_reader_num_ops:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  filters:
    type: "log_cache_num_ops"
  group_by: "type"
  layout:
    title: "Log Cache Num Ops"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "log_cache_num_ops": "Num Ops"

tserver_glog_info_messages:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  filters:
    type: "glog_info_messages"
  group_by: "exported_instance"
  layout:
    title: "TServer GLog Info Messages"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "glog_info_messages": "GLog info messages"

master_glog_info_messages:
  metric: "collectd_yb_master_counter_total"
  function: "avg"
  filters:
    type: "glog_info_messages"
  group_by: "exported_instance"
  layout:
    title: "Master GLog Info Messages"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "glog_info_messages": "GLog info messages"

lsm_rocksdb_num_seek_or_next:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.number.db.seek|rocksdb.number.db.next"
  group_by: "type"
  layout:
    title: "LSM-DB Seek/Next Num Ops"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.number.db.seek": "Seek"
        "rocksdb.number.db.next": "Next"

lsm_rocksdb_num_seeks_per_node:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.number.db.seek"
  group_by: "exported_instance"
  layout:
    title: "LSM-DB Seeks per node per sec"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.number.db.seek": "Seek"

lsm_rocksdb_blooms_checked_and_useful:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.bloom.filter.checked|rocksdb.bloom.filter.useful"
  group_by: "type"
  layout:
    title: "LSM-DB Blooms usefulness"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.bloom.filter.checked": "Blooms checked"
        "rocksdb.bloom.filter.useful": "Blooms useful"

lsm_rocksdb_latencies_get:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.db.get.micros.avg"
  group_by: "exported_instance"
  layout:
    title: "LSM-DB Get latencies (\u00B5s)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.db.get.micros.avg": "Get"

lsm_rocksdb_latencies_write:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.db.write.micros.avg"
  group_by: "exported_instance"
  layout:
    title: "LSM-DB Write latencies (\u00B5s)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.db.write.micros.avg": "Write"

lsm_rocksdb_latencies_seek:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.db.seek.micros.avg"
  group_by: "exported_instance"
  layout:
    title: "LSM-DB Seek latencies (\u00B5s)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.db.seek.micros.avg": "Seek"

lsm_rocksdb_latencies_mutex:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.db.mutex.wait.micros.avg"
  group_by: "exported_instance"
  layout:
    title: "LSM-DB Mutex Wait latencies (\u00B5s)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.db.mutex.wait.micros.avg": "Mutex"

lsm_rocksdb_block_cache_hit:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.block.cache.hit|rocksdb.block.cache.single.touch.hit|rocksdb.block.cache.multi.touch.hit"
  group_by: "type"
  layout:
    title: "Cache Hit"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.block.cache.hit": "Hit"
        "rocksdb.block.cache.single.touch.hit": "Single Touch Hit"
        "rocksdb.block.cache.multi.touch.hit": "Multi Touch Hit"

lsm_rocksdb_block_cache_miss:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.block.cache.miss"
  group_by: "exported_instance"
  layout:
    title: "Cache Miss"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.block.cache.miss": "Miss"

lsm_rocksdb_block_cache_add:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.block.cache.add|rocksdb.block.cache.single.touch.add|rocksdb.block.cache.multi.touch.add"
  group_by: "type"
  layout:
    title: "Cache Add"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.block.cache.add": "Add"
        "rocksdb.block.cache.single.touch.add": "Single Touch Add"
        "rocksdb.block.cache.multi.touch.add": "Multi Touch Add"

lsm_rocksdb_block_cache_bytes_read:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.block.cache.bytes.read|rocksdb.block.cache.single.touch.bytes.read|rocksdb.block.cache.multi.touch.bytes.read"
  group_by: "type"
  layout:
    title: "Block Cache Bytes Read"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.block.cache.bytes.read": "Total Bytes Read"
        "rocksdb.block.cache.single.touch.bytes.read": "Single Touch Bytes Read"
        "rocksdb.block.cache.multi.touch.bytes.read": "Multi Touch Bytes Read"

lsm_rocksdb_block_cache_bytes_write:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.block.cache.bytes.write|rocksdb.block.cache.single.touch.bytes.write|rocksdb.block.cache.multi.touch.bytes.write"
  group_by: "type"
  layout:
    title: "Block Cache Bytes Write"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.block.cache.bytes.write": "Total Bytes Written"
        "rocksdb.block.cache.single.touch.bytes.write": "Single Touch Bytes Written"
        "rocksdb.block.cache.multi.touch.bytes.write": "Multi Touch Bytes Written"

lsm_rocksdb_stalls:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.stall.micros"
  group_by: "exported_instance"
  layout:
    title: "Stalls (\u00B5s)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.stall.micros": "Stalls"

lsm_rocksdb_flush_size:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.flush.write.bytes"
  group_by: "exported_instance"
  layout:
    title: "Flush write (bytes)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.flush.write.bytes": "Flush"

lsm_rocksdb_compaction:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rocksdb.compact.read.bytes|rocksdb.compact.write.bytes"
  group_by: "exported_instance"
  layout:
    title: "Compaction (bytes)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rocksdb.compact.read.bytes": "Bytes Read"
        "rocksdb.compact.write.bytes": "Bytes Written"

lsm_rocksdb_compaction_numfiles:
  metric: "collectd_yb_tserver_counter_total"
  function: "avg"
  operator: "> 0"
  filters:
    type: "rocksdb.numfiles.in.singlecompaction.avg"
  group_by: "exported_instance"
  layout:
    title: "Compaction num files"
    xaxis:
      type: "date"
    yaxis:
      alias:
          "rocksdb.numfiles.in.singlecompaction.avg": "Avg"

lsm_rocksdb_compaction_time:
  metric: "collectd_yb_tserver_counter_total"
  function: "rate|avg"
  range: "1m"
  operator: "/ 1000000"
  filters:
    type: "rocksdb.compaction.times.micros.avg"
  group_by: "exported_instance"
  layout:
    title: "Compaction time (sec)"
    xaxis:
      type: "date"
    yaxis:
      alias:
          "rocksdb.compaction.times.micros.avg": "Avg"

#Cassandra Metrics
cql_server_rpc_per_second:
  metric: "collectd_yb_cql_counter_total"
  function: "rate|sum"
  range: "1m"
  filters:
    type: "rpc_SQLProcessor_SelectStmt.num|rpc_SQLProcessor_InsertStmt.num|rpc_SQLProcessor_UpdateStmt.num|rpc_SQLProcessor_DeleteStmt.num|rpc_SQLProcessor_OtherStmts.num"
  group_by: "type"
  layout:
    title: "Total CQL Ops / Sec"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_SQLProcessor_SelectStmt.num": "Select"
        "rpc_SQLProcessor_InsertStmt.num": "Insert"
        "rpc_SQLProcessor_UpdateStmt.num": "Update"
        "rpc_SQLProcessor_DeleteStmt.num": "Delete"
        "rpc_SQLProcessor_OtherStmts.num": "Other"

cql_sql_latency:
  metric: "collectd_yb_cql_counter_total"
  function: "avg"
  filters:
    type: "rpc_SQLProcessor_SelectStmt.avg|rpc_SQLProcessor_InsertStmt.avg|rpc_SQLProcessor_UpdateStmt.avg|rpc_SQLProcessor_DeleteStmt.avg|rpc_SQLProcessor_OtherStmts.avg"
  group_by: "type"
  layout:
    title: "CQL Op Execute Latencies Avg"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_SQLProcessor_SelectStmt.avg": "Select"
        "rpc_SQLProcessor_InsertStmt.avg": "Insert"
        "rpc_SQLProcessor_UpdateStmt.avg": "Update"
        "rpc_SQLProcessor_DeleteStmt.avg": "Delete"
        "rpc_SQLProcessor_OtherStmts.avg": "Others"
      ticksuffix: "&nbsp;\u00B5s"

cql_sql_latency_breakdown:
  metric: "collectd_yb_cql_counter_total"
  function: "avg"
  filters:
    type: "rpc_CQLServerService_ProcessRequest.avg|rpc_SQLProcessor_ParseRequest.avg|rpc_SQLProcessor_AnalyseRequest.avg|rpc_SQLProcessor_ExecuteRequest.avg"
  group_by: "type"
  layout:
    title: "CQL Latency Breakdown"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_CQLServerService_ProcessRequest.avg": "Total"
        "rpc_SQLProcessor_ParseRequest.avg": "Parse"
        "rpc_SQLProcessor_AnalyseRequest.avg": "Analyze"
        "rpc_SQLProcessor_ExecuteRequest.avg": "Execute"
      ticksuffix: "&nbsp;\u00B5s"

cql_yb_local_vs_remote:
  metric: "collectd_yb_cql_counter_total"
  function: "rate|avg"
  range: "1m"
  filters:
    type: "rpc_read_remote.num|rpc_write_remote.num|rpc_read_local.num|rpc_write_local.num"
  group_by: "type"
  layout:
    title: "YBClient Ops Local vs Remote"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_read_remote.num": "Remote Read"
        "rpc_write_remote.num": "Remote Write"
        "rpc_read_local.num": "Local Read"
        "rpc_write_local.num": "Local Write"

cql_yb_latency:
  metric: "collectd_yb_cql_counter_total"
  function: "avg"
  filters:
    type: "rpc_read_remote.avg|rpc_write_remote.avg|rpc_read_local.avg|rpc_write_local.avg"
  group_by: "type"
  layout:
    title: "YBClient Latency"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_read_remote.avg": "Remote Read"
        "rpc_write_remote.avg": "Remote Write"
        "rpc_read_local.avg": "Local Read"
        "rpc_write_local.avg": "Local Write"
      ticksuffix: "&nbsp;\u00B5s"

cql_reactor_latency:
  metric: "collectd_yb_cql_counter_total"
  function: "avg"
  filters:
    type: "rpc_incoming_queue_time.avg|handler_latency_outbound_transfer.avg|handler_latency_outbound_call_queue_time.avg"
  group_by: "type"
  layout:
    title: "YBClient Reactor Delays"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_incoming_queue_time.avg": "Incoming Queue"
        "handler_latency_outbound_transfer.avg": "Outbound transfer time"
        "handler_latency_outbound_call_queue_time.avg": "Outbound queue time"
      ticksuffix: "&nbsp;\u00B5s"

response_sizes:
  metric: "collectd_yb_cql_counter_total"
  function: "avg"
  filters:
    type: "rpc_SQLProcessor_ResponseSize.avg"
  group_by: "type"
  layout:
    title: "Response Size (bytes)"
    xaxis:
      type: "date"
    yaxis:
      alias:
        "rpc_SQLProcessor_ResponseSize.avg": "Response Size"
